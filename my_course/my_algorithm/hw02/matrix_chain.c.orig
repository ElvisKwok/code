#include <stdio.h>
#include <string.h>

const int MAX_STRING_LEN = 1000;
 
 struct Token
 {
    char str[5];
        int  value;
        }; 

        struct Token _tokens[]=
        {
            {"a",34},
                {"aa",36},
                    {"aaa",28},
                        {"ab",27},
                            {"aab",12},
                                {"bc",13},
                                    {"bbc",25},
                                        {"cd",20},
                                            {"ccd",18}
                                            };

                                            // 计算 tokens 元素个数 
                                            int _tokensNum = sizeof(_tokens)/sizeof(struct Token);

                                            /*
                                                如果字符串 str 的子串 str[start,end] 和  _tokens[i].str 匹配
                                                    返回  _tokens[i].value
                                                        
                                                            否则返回一个负数 
                                                            */  
                                                            int exist(char str[],int start,int end)
                                                            {
                                                                int p,i;
                                                                    for(p = 0 ; p < _tokensNum ; p ++)
                                                                        {
                                                                                // 字符串 str 子串的长度和字符串 _tokens[p].str 的长度匹配 
                                                                                        if( (end - start + 1) == strlen(_tokens[p].str) )
                                                                                                {
                                                                                                            // 逐个字符比较 
                                                                                                                        for(i = 0 ; i < strlen(_tokens[p].str) ; i ++)
                                                                                                                                    {
                                                                                                                                                    if(_tokens[p].str[i] != str[i+start])
                                                                                                                                                                    {
                                                                                                                                                                                        break;
                                                                                                                                                                                                        }
                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                
                                                                                                                                                                                                                                            // 字符串 str 子串和字符串 _tokens[p].str 匹配 
                                                                                                                                                                                                                                                        if(i == strlen(_tokens[p].str))
                                                                                                                                                                                                                                                                    {
                                                                                                                                                                                                                                                                                    // printf("%s %d %d\n",_tokens[p].str , start , end);
                                                                                                                                                                                                                                                                                                    return _tokens[p].value;
                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                    }// if
                                                                                                                                                                                                                                                                                                                                        } // for(p)
                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                // 没有匹配 
                                                                                                                                                                                                                                                                                                                                                    return -1;
                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                    /*
                                                                                                                                                                                                                                                                                                                                                    str             :   要分割的字符串      
                                                                                                                                                                                                                                                                                                                                                    splitPointNum   :   分割字符串 str 的分割点个数 
                                                                                                                                                                                                                                                                                                                                                    splitPoint      ：  分割字符串 str 的分割点数组 
                                                                                                                                                                                                                                                                                                                                                    value           :   用分割点 splitPoint 分割字符串 str ，获得的所有子串的权值的累加和 
                                                                                                                                                                                                                                                                                                                                                    counter         :   所有分割方法的总数 
                                                                                                                                                                                                                                                                                                                                                    */
                                                                                                                                                                                                                                                                                                                                                    void split(char str[] ,int splitPointNum ,int splitPoint[],int value , int * counter)
                                                                                                                                                                                                                                                                                                                                                    {
                                                                                                                                                                                                                                                                                                                                                        int i , j;
                                                                                                                                                                                                                                                                                                                                                            int p;
                                                                                                                                                                                                                                                                                                                                                                int v = 0;
                                                                                                                                                                                                                                                                                                                                                                    /*
                                                                                                                                                                                                                                                                                                                                                                         开始分割的位置 
                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                         如果已经有分割点 (splitPointNum > 0 ) ， 
                                                                                                                                                                                                                                                                                                                                                                                                    当前分割点为最后一个分割点 splitPoint[splitPointNum - 1] 
                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                    否则，从起点 0 开始分割 
                                                                                                                                                                                                                                                                                                                                                                                                                        */
                                                                                                                                                                                                                                                                                                                                                                                                                            int startPos = (splitPointNum > 0 ) ? splitPoint[splitPointNum - 1]  : 0 ;
                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                    // 已经分割完毕 
                                                                                                                                                                                                                                                                                                                                                                                                                                        if(startPos >= strlen(str))
                                                                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                                                                                    if(splitPointNum == 0)
                                                                                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                //      for(i = 0 ; i < splitPointNum ; i ++)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                //      {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                //          printf("%d ",splitPoint[i]); 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                //      }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                //      printf("\n");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                for(i = 0 , j = 0 ; str[i] != '\0' ; i ++)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // 从当前字符开始分割出一个字符，打印一个空格 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if(i == splitPoint[j])
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            printf(" ");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            j++;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    printf("%c",str[i]) ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // 输出所有子串的权值的累加和 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            printf(" %d\n",value);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // 统计
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    (*counter)++ ;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // 不再递归 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            return; 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        // 枚举所有可以分割字符串 str 的位置，从 startPos 开始 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            for(p = startPos ; p < strlen(str) ; p ++)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                { 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        v = exist(str,startPos,p);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // v 大于零，说明从 _tokes 数组中找到一个可以匹配的 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if(v > 0)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // 添加一个分割点 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        splitPoint[splitPointNum] = startPos + (p - startPos) + 1;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // 递归 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                split(str,splitPointNum + 1,splitPoint, value + v,counter); 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            int main(int argc, char *argv[])
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    char  str[MAX_STRING_LEN];
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        int   splitPoint[MAX_STRING_LEN]={0};
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            int   counter = 0; 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                while(gets(str) != NULL)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            counter = 0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    split(str,0,splitPoint,0,&counter); 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            printf("exist %4d split method!\n",counter); 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                } 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return 0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
